<!-- This file is generated by [/src/scripts/client_readmes.zig](/src/scripts/client_readmes.zig). -->
# Many Two-Phase Transfers Go Sample

Code for this sample is in [./main.go](./main.go).

## Prerequisites

Linux >= 5.6 is the only production environment we
support. But for ease of development we also support macOS and Windows.
* Go >= 1.21

**Additionally on Windows**: you must install [Zig
0.13.0](https://ziglang.org/download/#release-0.13.0) and set the
`CC` environment variable to `zig.exe cc`. Use the full path for
`zig.exe`.

## Setup

First, clone this repo and `cd` into `tigerbeetle/src/clients/go/samples/two-phase-many`.

Then, install the TigerBeetle client:

```console
go mod init tbtest
go get github.com/tigerbeetle/tigerbeetle-go
```

## Start the TigerBeetle server

Follow steps in the repo README to [run
TigerBeetle](/README.md#running-tigerbeetle).

If you are not running on port `localhost:3000`, set
the environment variable `TB_ADDRESS` to the full
address of the TigerBeetle server you started.

## Run this sample

Now you can run this sample:

```console
go run main.go
```

## Walkthrough

Here's what this project does.

## 1. Create accounts

This project starts by creating two accounts (`1` and `2`).

## 2. Create pending transfers

Then it begins 5 pending transfers of amounts `100` to
`500`, incrementing by `100` for each transfer.

## 3. Fetch and validate pending account balances

Then it fetches both accounts and validates that **account `1`** has:
 * `debits_posted = 0`
 * `credits_posted = 0`
 * `debits_pending = 1500`
 * and `credits_pending = 0`

And that **account `2`** has:
 * `debits_posted = 0`
 * `credits_posted = 0`
 * `debits_pending = 0`
 * and `credits_pending = 1500`

(This is because a pending transfer only affects **pending**
credits and debits on accounts, not **posted** credits and
debits.)

## 4. Post and void alternating transfers

Then it alternatively posts and voids each transfer,
checking account balances after each transfer.

## 6. Fetch and validate final account balances

Finally, it fetches both accounts, validates they both exist,
and checks that credits and debits for both account are now
solely *posted*, not pending.

Specifically, that **account `1`** has:
 * `debits_posted = 900`
 * `credits_posted = 0`
 * `debits_pending = 0`
 * and `credits_pending = 0`

And that **account `2`** has:
 * `debits_posted = 0`
 * `credits_posted = 900`
 * `debits_pending = 0`
 * and `credits_pending = 0`
